#7 –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞: –º–æ–¥–µ–ª—å —Ä–∞–∑–æ—Ä–µ–Ω–∏—è —Å—Ç—Ä–∞—Ö–æ–≤–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
library(VGAM)
library(ggplot2)
#1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å 1000 —Å–ª—É—á–∞–π–Ω—ã—Ö –≤–µ–ª–∏—á–∏–Ω ùëÅùë° –ø—Ä–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –∑–Ω–∞—á–µ–Ω–∏–∏ùë° = 50, ùúÜ = 2;
set.seed(123)
t = 50
lamda = 2
N = 1000
Nt = rpois(N, lamda*t)
Nt
range(Nt)

#2. –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—É –≥—Ä–∞—Ñ–∏–∫–∞ (13):
# y = ..density.. : —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏,
f = function(x,lambda,t) { res = (lamda*t)^x/factorial(x)*exp(-lamda*t)
                           return(res)}
ggplot(data.frame(Nt), aes(x = Nt)) +
       geom_histogram(aes(y = ..density..), binwidth = 2, color = "black", fill = "white") +
       labs(title = "–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞_1 Nt", x = "Nt", y = "Density") +
       theme_minimal()

hist(Nt,  main = "–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ Nt", col = "grey", freq = FALSE)
grid()
hist(Nt,  main = "–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ Nt", prob = TRUE, add = TRUE, col = "grey",freq = FALSE)
curve(f(x,lambda,t), add=TRUE, col = "red",xlim=c(min(Nt),max(Nt)), lwd=2, lty=2)

#3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å (12) –¥–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ ùë°ùëöùëéùë• –∏–ø–æ—Å—Ç—Ä–æ–∏—Ç—å –µ–≥–æ –≥—Ä–∞—Ñ–∏–∫.
#–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º, —á—Ç–æ —Å—Ç—Ä–∞—Ö–æ–≤—ã–µ –≤—ã–ø–ª–∞—Ç—ã ùëãùëñ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–º—É –∑–∞–∫–æ–Ω—É —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º —Ä–∞–≤–Ω—ã–º 1/ùúá:
mu = 3
U_0 = 50
t_max = 1000
rho = (U_0 + lamda*mu)/(mu*lamda) - 1
if (rho > 0) {T = c(0)
              U = c(U_0)
              Nt = 0
  while (sum(diff(T)) < t_max) {tau = rexp(1, lamda)
                                xi = rexp(1, mu)
                                Nt = Nt + 1
                                T[Nt+1] = T[Nt] + tau
                                U[Nt+1] = U[Nt] + tau - xi
                               }
  plot(T, U, type = "l", xlab = "Time", ylab = "U")
} else {cat("–£—Å–ª–æ–≤–∏–µ (15) –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è")}

#4 –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –≤—ã–±–æ—Ä–æ—á–Ω—É—é –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ä–∞–∑–æ—Ä–µ–Ω–∏—è —Ñ–∏—Ä–º—ã. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–ø–æ–ª–Ω–∏–º–æ—Å—Ç—å —É—Å–ª–æ–≤–∏—è (16):
A = rep(0, N)
for (i in 1:N) {T = c(0)
                U = c(U_0)
                Nt = 0
                while (sum(diff(T)) < t_max) {tau = rexp(1, lamda)
                                              xi = rexp(1, mu)
                                              Nt = Nt + 1
                                              T[Nt+1] = T[Nt] + tau
                                              U[Nt+1] = U[Nt] + tau - xi
                                              if (U[Nt+1] < 0) {A[i] = 1
                                                                break}
                                             }
                }
psi_hat = mean(A)
if (rho > 0) {psi = exp(-rho*U_0/(1+rho))
              cat("–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ä–∞–∑–æ—Ä–µ–Ω–∏—è:", psi_hat, "\n")
              cat("–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ä–∞–∑–æ—Ä–µ–Ω–∏—è:", psi, "\n")
              } else {cat("–£—Å–ª–æ–≤–∏–µ (15) –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è.")}
